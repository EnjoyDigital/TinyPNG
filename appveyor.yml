version: 1.0.{build}
os: Visual Studio 2015
init:
- ps: $Env:LABEL = "CI" + $Env:APPVEYOR_BUILD_VERSION.PadLeft(5, "0")
install:
- cmd: appveyor DownloadFile https://download.microsoft.com/download/A/3/8/A38489F3-9777-41DD-83F8-2CBDFAB2520C/packages/DotNetCore.1.0.0-SDK.Preview2-x64.exe
- cmd: DotNetCore.1.0.0-SDK.Preview2-x64.exe /quiet
environment:
  PATH: $(PATH);$(PROGRAMFILES)\dotnet\
build:
  verbosity: minimal
  publish_nuget: true

build_script:
- dotnet restore -v Minimal
- dotnet build **\project.json -c %CONFIGURATION%
- dotnet pack -c %CONFIGURATION% --version-suffix %LABEL% -o .\artifacts .\src\TinyPNG\project.json
test_script:
- cmd: dotnet test -c %CONFIGURATION% --no-build .\tests\TinyPng.Tests\
artifacts:
- path: artifacts\**\*.*
configuration: Release
deploy:
- provider: NuGet
  api_key:
    secure: Gerln5x/jQ3CsCjXe76zQuP2Rjh12sKBH2wj88LIpt1IQym1+6MlFVWmvx5j+KSw
  skip_symbols: false
  artifact: /.*\.nupkg/
  on:
    branch: release
cache:
- '%USERPROFILE%\.nuget\packages'    